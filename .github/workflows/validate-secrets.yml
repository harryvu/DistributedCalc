name: Validate Publish Profile Format

on:
  workflow_dispatch:

jobs:
  validate-adding:
    name: Validate Adding Service Publish Profile
    runs-on: ubuntu-latest
    steps:
      - name: Check publish profile format
        env:
          PUBLISH_PROFILE: ${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE_ADDING }}
        run: |
          if [ -z "$PUBLISH_PROFILE" ]; then
            echo "❌ ERROR: AZURE_FUNCTIONAPP_PUBLISH_PROFILE_ADDING is empty or not set"
            exit 1
          fi
          
          # Check if it looks like valid XML
          if echo "$PUBLISH_PROFILE" | grep -q "publishData"; then
            echo "✅ Publish profile contains publishData element"
          else
            echo "❌ ERROR: Publish profile doesn't contain publishData element"
            exit 1
          fi
          
          # Check for userName (SCM credentials)
          if echo "$PUBLISH_PROFILE" | grep -q "userName"; then
            echo "✅ Publish profile contains userName"
          else
            echo "❌ ERROR: Publish profile doesn't contain userName"
            exit 1
          fi
          
          # Check for userPWD
          if echo "$PUBLISH_PROFILE" | grep -q "userPWD"; then
            echo "✅ Publish profile contains userPWD"
          else
            echo "❌ ERROR: Publish profile doesn't contain userPWD"
            exit 1
          fi
          
          echo "✅ All validation checks passed for Adding service publish profile"

  validate-subtracting:
    name: Validate Subtracting Service Publish Profile
    runs-on: ubuntu-latest
    steps:
      - name: Check publish profile format
        env:
          PUBLISH_PROFILE: ${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE_SUBTRACTING }}
        run: |
          if [ -z "$PUBLISH_PROFILE" ]; then
            echo "❌ ERROR: AZURE_FUNCTIONAPP_PUBLISH_PROFILE_SUBTRACTING is empty or not set"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "publishData"; then
            echo "✅ Publish profile contains publishData element"
          else
            echo "❌ ERROR: Publish profile doesn't contain publishData element"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "userName"; then
            echo "✅ Publish profile contains userName"
          else
            echo "❌ ERROR: Publish profile doesn't contain userName"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "userPWD"; then
            echo "✅ Publish profile contains userPWD"
          else
            echo "❌ ERROR: Publish profile doesn't contain userPWD"
            exit 1
          fi
          
          echo "✅ All validation checks passed for Subtracting service publish profile"

  validate-multiplying:
    name: Validate Multiplying Service Publish Profile
    runs-on: ubuntu-latest
    steps:
      - name: Check publish profile format
        env:
          PUBLISH_PROFILE: ${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE_MULTIPLYING }}
        run: |
          if [ -z "$PUBLISH_PROFILE" ]; then
            echo "❌ ERROR: AZURE_FUNCTIONAPP_PUBLISH_PROFILE_MULTIPLYING is empty or not set"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "publishData"; then
            echo "✅ Publish profile contains publishData element"
          else
            echo "❌ ERROR: Publish profile doesn't contain publishData element"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "userName"; then
            echo "✅ Publish profile contains userName"
          else
            echo "❌ ERROR: Publish profile doesn't contain userName"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "userPWD"; then
            echo "✅ Publish profile contains userPWD"
          else
            echo "❌ ERROR: Publish profile doesn't contain userPWD"
            exit 1
          fi
          
          echo "✅ All validation checks passed for Multiplying service publish profile"

  validate-dividing:
    name: Validate Dividing Service Publish Profile
    runs-on: ubuntu-latest
    steps:
      - name: Check publish profile format
        env:
          PUBLISH_PROFILE: ${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE_DIVIDING }}
        run: |
          if [ -z "$PUBLISH_PROFILE" ]; then
            echo "❌ ERROR: AZURE_FUNCTIONAPP_PUBLISH_PROFILE_DIVIDING is empty or not set"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "publishData"; then
            echo "✅ Publish profile contains publishData element"
          else
            echo "❌ ERROR: Publish profile doesn't contain publishData element"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "userName"; then
            echo "✅ Publish profile contains userName"
          else
            echo "❌ ERROR: Publish profile doesn't contain userName"
            exit 1
          fi
          
          if echo "$PUBLISH_PROFILE" | grep -q "userPWD"; then
            echo "✅ Publish profile contains userPWD"
          else
            echo "❌ ERROR: Publish profile doesn't contain userPWD"
            exit 1
          fi
          
          echo "✅ All validation checks passed for Dividing service publish profile"
